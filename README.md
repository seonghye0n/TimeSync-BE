# ğŸš€ ì—°ì°¨/ë‹¹ì§ ê´€ë¦¬ í”„ë¡œì íŠ¸

## ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
- [í”„ë¡œì íŠ¸ ê¸°ê°„](#-í”„ë¡œì íŠ¸-ê¸°ê°„)
- [íŒ€ì› ì†Œê°œ](#-íŒ€ì›-ì†Œê°œ)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ê¸°ìˆ  ì•„í‚¤í…ì²˜](#-ê¸°ìˆ -ì•„í‚¤í…ì²˜)
- [í”„ë¡œì íŠ¸ ì„¸ë¶€ ì‚¬í•­](#-í”„ë¡œì íŠ¸-ì„¸ë¶€ì‚¬í•­)
- [ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•](#-ì„¤ì¹˜-ë°-ì‹¤í–‰ë°©ë²•)
- [DB ì„¤ê³„](#-DB-ì„¤ê³„)
- [API ë¬¸ì„œ](#-API-ë¬¸ì„œ)
- [ê¸°ìˆ  ì„¤ëª…](#-ê¸°ìˆ -ì„¤ëª…)

## ğŸŒŸ í”„ë¡œì íŠ¸ ê°œìš”

"ì—°ì°¨/ë‹¹ì§ ì„ ê´€ë¦¬í•˜ëŠ”ë° ì¢€ ë” íš¨ìœ¨ì ì´ê³  í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ê²Œë” ë§Œë“¤ì–´ì¡Œë‹¤."

## ğŸ“… í”„ë¡œì íŠ¸ ê¸°ê°„

### 2023ë…„ 7ì›” 25ì¼ - 2023ë…„ 8 ì›” 11ì¼

## ğŸ‘¥ íŒ€ì› ì†Œê°œ

|                                                                                                                     **[ë°•ì„±í˜„(BE-íŒ€ì¥)](https://github.com/seonghye0n)**                                                                                                                     |                                                                                                      **[ì„œìš©í˜„](https://github.com/zjdtm)**                                                                                                       |
|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|                                                                                                      <img src="https://avatars.githubusercontent.com/u/53041717?v=4" width="300">                                                                                                       |                                                                                  <img src="https://avatars.githubusercontent.com/u/35757620?v=4" width="300">                                                                                  |
| <ol> <b>API</b> <li>ë©”ì¸í˜ì´ì§€ ì¡°íšŒ</li> <li>ì—°ì°¨ë“±ë¡, ìˆ˜ì •, ì‚­ì œ</li> <li>ë§ˆì´ í˜ì´ì§€ ì¡°íšŒ</li> <li>ê´€ë¦¬ì í˜ì´ì§€ ì¡°íšŒ</li> <li> ê²°ì¬ ìŠ¹ì¸</li> </ol> <ol><b>DB</b> <li>í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì´ˆì•ˆ ì‘ì„±</li> </ol> <ol><b>ì„œë²„/ë°°í¬</b> <li>í…ŒìŠ¤íŠ¸ ì„œë²„ êµ¬ì„±(EC2)</li> <li>SSL ì ìš©</li> <li>ìš´ì˜ ì„œë²„ êµ¬ì„± <br>(Elastic Beanstalk)</li> <li>ë°°í¬ ìë™í™”</li></ol> | <ol><b>API</b> <li>ë¡œê·¸ì¸</li> <li>íšŒì›ê°€ì…</li> <li>ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •</li></ol> <ol><b>DB</b> <li>Redis êµ¬ì„± (RefreshToken ê´€ë¦¬)</li></ol> <ol><b>ë³´ì•ˆ/ì¸ì¦</b> <li>JWT Token êµ¬í˜„ (AccessToken, RefreshToken)</li> <li>Spring Security ì„¤ì •</li> <li>AES ì•”í˜¸í™” êµ¬í˜„</li></ol> |

<br>

## ğŸš€ ê¸°ìˆ  ìŠ¤íƒ

<div align=center>

<img src="https://img.shields.io/badge/java-007396?style=for-the-badge&logo=java&logoColor=white"> 
<img src="https://img.shields.io/badge/springboot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
<img src="https://img.shields.io/badge/springsecurity-6DB33F?style=for-the-badge&logo=springsecurity&logoColor=white">

<img src="https://img.shields.io/badge/Amazon EC2-FF9900?style=for-the-badge&logo=amazonec2&logoColor=white">
<img src="https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=Redis&logoColor=white">
<img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">
<img src="https://img.shields.io/badge/Gradle-02303A?style=for-the-badge&logo=Gradle&logoColor=white">
<img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white">

<img src="https://img.shields.io/badge/GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white">
<img src="https://img.shields.io/badge/Nginx-009639?style=for-the-badge&logo=Nginx&logoColor=white">
<img src="https://img.shields.io/badge/RDS-527FFF?style=for-the-badge&logo=AmazonRDS&logoColor=white">

</div>

## ğŸ›ï¸ ê¸°ìˆ  ì•„í‚¤í…ì²˜

![image](https://github.com/seonghye0n/miniproject/assets/35757620/fe3cdfa9-b374-4645-aed9-7c2af8235ed9)

## ğŸ“ í”„ë¡œì íŠ¸ ì„¸ë¶€ì‚¬í•­

- ### ğŸ“… ì—°ì°¨ ë° ë‹¹ì§ ê´€ë¦¬ ì‹œìŠ¤í…œ ê°œë°œ
  ![ì—°ì°¨, ë‹¹ì§ ê´€ë¦¬ ì‹œìŠ¤í…œ](https://github.com/seonghye0n/miniproject/assets/35757620/4417377f-cc9c-4d24-afd8-f100e2242c9e)
- ### ğŸ’¼ ì‚¬ìš©ì ì¹œí™”ì ì¸ UI/UX ë””ìì¸
  ![ì—°ì°¨, ë‹¹ì§ ë©”ì¸ í˜ì´ì§€](https://github.com/seonghye0n/miniproject/assets/35757620/7043bdf6-c4ce-45eb-ae0b-fc4a56a9f8af)
- ### ğŸ› ï¸ ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œ í˜‘ì—…ì„ í†µí•œ í”„ë¡œì íŠ¸
  í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸
  ë§í¬ : https://github.com/FastCampusGroupFE9/MiniProject_KDT9

## âš™ï¸ ì„¤ì¹˜ ë° ì‹¤í–‰ë°©ë²•

í”„ë¡œì íŠ¸ ë§í¬ : https://hmteresting.netlify.app/

ê´€ë¦¬ì ê³„ì • : admin@admin.com / fastcampus12#$

## ğŸ“‘ DB ì„¤ê³„

### ERD

![ERD](https://github.com/seonghye0n/miniproject/assets/53041717/6a3d9cdd-28e7-45e2-92fa-aba6c7164fd2)

### member

```sql
create table member
(
    id               bigint primary key auto_increment,
    email            varchar(100) unique not null,
    password         varchar(100)        not null,
    name             varchar(100)        not null,
    joined_at        date                not null,
    role             varchar(10)         not null,
    annual_amount_id bigint              not null,
    annual_used      int,
    annual_remain    int,
    position         varchar(5)          not null,
    loggedin_at      timestamp,
    created_at       timestamp           not null,
    modified_at      timestamp,
    foreign key (annual_amount_id) references annual (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### req

```sql
create table reg
(
    id          bigint primary key auto_increment,
    category    varchar(10) not null,
    title       varchar(40) not null,
    started_at  date        not null,
    lasted_at   date        not null,
    reason      varchar(20),
    status      varchar(10) not null,
    member_id   bigint,
    created_at  timestamp   not null,
    modified_at timestamp,
    foreign key (member_id) references member (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### annual

```sql
create table annual
(
    id            bigint primary key auto_increment,
    years         int        not null,
    annual_amount int        not null,
    position      varchar(5) not null,
    hist_year     varchar(4) not null,
    unique (years, position, hist_year)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### login_log

```sql
create table login_log
(
    id                 bigint primary key auto_increment,
    user_agent         varchar(200) not null,
    client_ip          varchar(15)  not null,
    member_id          bigint       not null,
    success_login_date timestamp,
    foreign key (member_id) references member (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### refresh_token

```sql
create table refresh_token
(
    id            bigint       not null auto_increment,
    email         varchar(255) not null,
    refresh_token varchar(255) not null,
    primary key (id)
) engine=InnoDB DEFAULT CHARSET=utf8mb4;
```

## ğŸ“„ API ë¬¸ì„œ

| ì—”ë“œí¬ì¸íŠ¸                | ë©”ì†Œë“œ  | ìš”ì²­ ë³¸ë¬¸ (Request Body)                                                                                                   | ìš”ì²­ í—¤ë” (Request Headers)                                           | ì‘ë‹µ ë³¸ë¬¸ (Response Body)                                                                                    |
|----------------------|------|------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| `/api/register`      | POST | ``` {email: asd@asd.com, password: 1234567, name: â€œì•„ë¬´ê°œâ€, join: YYYY-MM-DD } ```                                        | -                                                                 | `ìƒíƒœê°’ 200 ok,json body ì— â€œíšŒì›ê°€ì…ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤â€. ë©”ì‹œì§€`                                                            |
| `/api/login`         | POST | -                                                                                                                      | `{ email: ì´ë©”ì¼password: íŒ¨ìŠ¤ì›Œë“œ}`                                     | `ìƒíƒœê°’ 200 ok, accessToken ì€ json body, refreshToken ì€ cookie ê°’ì— ì €ì¥`                                       |
| `/api/token`         | POST | `{"startDate": "2023-08-15", "endDate": "2023-08-20"}`                                                                 | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | `ìƒíƒœê°’ 200 ok, accessToken ì€ json body, refreshToken ì€ cookie ê°’ì— ì €ì¥`                                       |
| `/api/logout`        | POST | -                                                                                                                      | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | `ìƒíƒœê°’ 200 ok, ë©”ì‹œì§€`                                                                                        |
| `/api/main`          | GET  | `                                                                                                                      | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | ![image](https://github.com/seonghye0n/miniproject/assets/35757620/a4400c07-dc53-4f54-9823-f469c7b32f6c) | 
| `/api/annual`        | POST | `{â€œtitleâ€ : â€œì—°ì°¨ ì‹ ì²­í•©ë‹ˆë‹¹~~â€, â€œcategoryâ€ : â€œì—°ì°¨â€, â€œstartDateâ€ : â€œ2023-08-02â€, â€œendDateâ€ : â€œ2023-08-07â€,  â€œreasonâ€ : â€œë³‘ê°€â€ }` | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | `ìƒíƒœê°’ 200 ok, ë©”ì‹œì§€`                                                                                        | 
| `/api/user`          | GET  | -                                                                                                                      | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | ![image](https://github.com/seonghye0n/miniproject/assets/35757620/2f97ee06-c667-4ee8-8a8e-f04df02e47ff) |
| `/api/user`          | POST | `{â€œnewPasswordâ€ : â€œìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸â€ }`                                                                                        | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | `ìƒíƒœê°’ 200 ok, ë©”ì‹œì§€`                                                                                        |
| `/api/annual/cancel` | POST | {â€œidâ€ : annul ë²ˆí˜¸}                                                                                                      | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | `ìƒíƒœê°’ 200. ë©”ì‹œì§€`                                                                                           |
| `/api/annual/update` | POST | {â€œidâ€ : 1, â€œtitleâ€ : â€œì—°ì°¨ ìˆ˜ì •í•©ë‹ˆë‹¤~~â€, â€œstartDateâ€ : â€œ2023-08-01â€, â€œendDateâ€ : â€œ2023-08-04â€,â€œreasonâ€ : â€œë³‘ê°€â€}               | `Authorization: Bearer your_access_token`, `Cookie: refreshToken  | `ìƒíƒœê°’ 200 ok ë©”ì‹œì§€`                                                                                         |
| `/api/admin`         | GET  | -                                                                                                                      | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | ![image](https://github.com/seonghye0n/miniproject/assets/35757620/69352c1e-6c42-48f1-b413-01909345a239) |
| `/api/admin/apply`   | POST | { â€œidâ€ : 1 }                                                                                                           | `Authorization: Bearer your_access_token`, `Cookie: refreshToken` | `ìƒíƒœê°’ 200 ok, ë©”ì‹œì§€`                                                                                        |

## ğŸ› ï¸ ê¸°ìˆ  ì„¤ëª…

### Java ë° Spring Boot

í”„ë¡œì íŠ¸ëŠ” Java ì–¸ì–´ì™€ Spring Boot í”„ë ˆì„ì›Œí¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. Spring BootëŠ” ê°„ê²°í•˜ê³  íš¨ìœ¨ì ì¸ ì½”ë“œ ì‘ì„±ì„ ì§€ì›í•˜ë©°, í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ”ë° í™œìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

### Amazon EC2 ë° RDS

í”„ë¡œì íŠ¸ëŠ” Amazon EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì„œë²„ì™€ ìš´ì˜ ì„œë²„ë¥¼ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ëŠ” Amazon RDSë¥¼ ì´ìš©í•˜ì—¬ ê´€ë¦¬ë˜ë©°, ì•ˆì •ì ì¸ ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### Redis ë¡œ RefreshToekn ê´€ë¦¬

Redisë¥¼ ì‚¬ìš©í•˜ì—¬ RefreshToken ì„ êµ¬í˜„í•˜ì˜€ë‹¤. í† í°ì˜ ë§Œë£Œê¸°ê°„ì„ Redsi ì˜ ìœ íš¨ê¸°ê°„ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ í† í°ì„ ì¢€ ë” ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ê³  ì‚­ì œí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### Spring Security ë° JWT ì¸ì¦

Spring Securityë¥¼ í†µí•´ ê°•ë ¥í•œ ë³´ì•ˆ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ìœ¼ë©°, JWT(JSON Web Token) ê¸°ë°˜ì˜ ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•œ ì‚¬ìš©ì ì¸ì¦ì„ ë³´ì¥í•©ë‹ˆë‹¤.

### GitHub Actionsë¥¼ í†µí•œ ìë™ ë°°í¬

í”„ë¡œì íŠ¸ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” GitHub Actionsë¥¼ í™œìš©í•˜ì—¬ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë° ë°°í¬ë˜ë©°, ê°œë°œìë“¤ì˜ ì‘ì—… íë¦„ì„ ìë™í™”í•˜ê³  íš¨ìœ¨ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.

---

## ğŸ‘¨â€ğŸ« ì½”ë“œë¦¬ë·° ìš”ì²­

### <img width="15" alt="star1" src="https://user-images.githubusercontent.com/78655692/151471925-e5f35751-d4b9-416b-b41d-a059267a09e3.png"> ì½”ë“œ ë¦¬ë·° ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤ !!

`ë°•ì„±í˜„`

1. ì—¬ëŸ¬ DTOì— ê³µí†µëœ í•„ë“œë“¤ì´ ìˆëŠ”ë° í•œë²ˆì— Validation ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë°©ë²•ì´ ìˆì„ê¹Œìš”? ì–´ë–¤ í‚¤ì›Œë“œë¡œ ì°¾ì•„ë´ì•¼ë ì§€ ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤..! ì˜ˆë¥¼
   ë“¤ì–´ì„œ [ì—°ì°¨/ë‹¹ì§ Request DTO](https://github.com/seonghye0n/miniproject/blob/33b38bec1f4b52ba97dc76585a7768d4269c9ace/src/main/java/com/example/miniproject/domain/annual/dto/AnnualRequestDto.java#L28)
   ì— SaveDto, UpdateDto ë‘ Dtoì— ê³µí†µëœ í•„ë“œë“¤ì´ ìˆëŠ”ë° messageë¥¼ ì¼ì¼ì´ ì…ë ¥í•˜ëŠ”ê²Œ ë²ˆê±°ë¡­ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤!
2. ì½”ë“œ ê´€ë ¨ì€ ì•„ë‹ˆì§€ë§Œ ê¶ê¸ˆí•œê²Œ ìˆì–´ì„œ ì§ˆë¬¸ë“œë¦½ë‹ˆë‹¤. ì²« ë©˜í† ë§ ë•Œ, í˜„ì—…ì—ì„œë„ ê°œì¸ì •ë³´ë¥¼ ì•”í˜¸í™”í•œ ê°’ì„ DBì— ì €ì¥í•œë‹¤ê³  í•˜ì…¨ëŠ”ë° í˜¹ì‹œ ì§ì ‘ ì¿¼ë¦¬ë¡œ ì¡°íšŒí•˜ì‹¤ ë•ŒëŠ” ì•”í˜¸í™”ëœ ê°’ì„ ì–´ë–»ê²Œ ë³µí˜¸í™”í•˜ë‚˜ìš”?? ì˜ˆë¥¼
   ë“¤ì–´, í˜„ì¬ ì´ë¦„ì´ ì•”í˜¸í™”í•œ ê°’ìœ¼ë¡œ DBì— ì €ì¥ë˜ê³  ìˆëŠ”ë°, ê´€ë¦¬ìê°€ ê¸‰í•˜ê²Œ íŠ¹ì • ì´ë¦„ìœ¼ë¡œ íšŒì›ëª©ë¡ì„ ë½‘ì•„ë‹¬ë¼ê³  ìš”ì²­í•˜ë©´ ì–´ë–»ê²Œ ì¡°íšŒí•  ìˆ˜ ìˆëŠ”ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤.

`ì„œìš©í˜„`

1. **SecurityConfig filter**
    - ì •ì‹ ì—†ì´ ê¸°ëŠ¥êµ¬í˜„ì—ë§Œ ì§‘ì¤‘í•˜ë‹¤ê°€ ë³´ë‹ˆ í•„í„° í•˜ë‚˜ì˜ ë„ˆë¬´ ë§ì€ ê¸°ëŠ¥ì„ ì¶”ê°€í•œ ê²ƒ ê°™ì•„ì„œ í˜„ì¬ ë¶€ë¶„ì˜ cookie ê²€ì¦ ë¶€ë¶„ì´ë‚˜, jwt ìƒì„± ë¶€ë¶„ì„ ë‹¤ë¥¸ í•„í„°ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œ í•˜ëŠ” ìƒê°ì…ë‹ˆë‹¤.

2. **ë¡œê·¸ì¸ ì‹œ ì‘ë‹µê°’ ë¶€ë¶„**
    - í”„ë¡ íŠ¸ ìš”êµ¬ì‚¬í•­ìœ¼ë¡œëŠ” body ì— accessToken, role(íšŒì›ì˜ ê¶Œí•œ) ì„ ë‹´ì•„ì„œ ë³´ë‚´ì£¼ëŠ” ê²ƒì´ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ëŠ”ë° role ë¶€ë¶„ë„ jwt ì— subject ì— ë„£ëŠ” ê²ƒì´ ë” ì¢‹ì€ì§€
      ê¶ê¸ˆí•©ë‹ˆë‹¤.

3. **MemberRequestDto, GlobalExceptionHandler**
    - validation ì—ëŸ¬ë¥¼ handler ì²˜ë¦¬ë¥¼ í•˜ë ¤ê³  ì‘ì„±í•˜ì˜€ëŠ”ë° êµ³ì´ ì´ê±° í•˜ë‚˜ ë•Œë¬¸ì— handler ì²˜ë¦¬í•˜ê¸°ì—ëŠ” ì´ìƒí•˜ë‹¤ê³  ìƒê°ì´ ë“­ë‹ˆë‹¤. ì´ëŸ° ìƒí™©ì—ì„œëŠ” handler ì²˜ë¦¬ í•˜ëŠ” ë°©ë²•ì„ ì•Œê³ 
      ì‹¶ìŠµë‹ˆë‹¤.

4. **ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ Controller, SecurityConfig**
    - login, logout ì„ security ì— filterë¡œ êµ¬í˜„í•˜ì§€ ì•Šê³  MemberController ì— ë©”ì„œë“œ í˜•íƒœë¡œ ì‘ì„±í•˜ì˜€ëŠ”ë° ì´ëŸ° ì‹ì˜ ì½”ë“œ ì‘ì„±ì´ ì¢‹ì€ì§€ filter ì— ì ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì€ì§€
      ê¶ê¸ˆí•©ë‹ˆë‹¤.